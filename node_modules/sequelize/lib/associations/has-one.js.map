{
  "version": 3,
  "sources": ["../../src/associations/has-one.js"],
  "sourcesContent": ["'use strict';\n\nconst Utils = require('./../utils');\nconst Helpers = require('./helpers');\nconst _ = require('lodash');\nconst Association = require('./base');\nconst Op = require('../operators');\n\n/**\n * One-to-one association\n *\n * In the API reference below, add the name of the association to the method, e.g. for `User.hasOne(Project)` the getter will be `user.getProject()`.\n * This is almost the same as `belongsTo` with one exception - The foreign key will be defined on the target model.\n *\n * @see {@link Model.hasOne}\n */\nclass HasOne extends Association {\n  constructor(source, target, options) {\n    super(source, target, options);\n\n    this.associationType = 'HasOne';\n    this.isSingleAssociation = true;\n    this.foreignKeyAttribute = {};\n\n    if (this.as) {\n      this.isAliased = true;\n      this.options.name = {\n        singular: this.as\n      };\n    } else {\n      this.as = this.target.options.name.singular;\n      this.options.name = this.target.options.name;\n    }\n\n    if (_.isObject(this.options.foreignKey)) {\n      this.foreignKeyAttribute = this.options.foreignKey;\n      this.foreignKey = this.foreignKeyAttribute.name || this.foreignKeyAttribute.fieldName;\n    } else if (this.options.foreignKey) {\n      this.foreignKey = this.options.foreignKey;\n    }\n\n    if (!this.foreignKey) {\n      this.foreignKey = Utils.camelize(\n        [\n          Utils.singularize(this.options.as || this.source.name),\n          this.source.primaryKeyAttribute\n        ].join('_')\n      );\n    }\n\n    if (\n      this.options.sourceKey\n      && !this.source.rawAttributes[this.options.sourceKey]\n    ) {\n      throw new Error(`Unknown attribute \"${this.options.sourceKey}\" passed as sourceKey, define this attribute on model \"${this.source.name}\" first`);\n    }\n\n    this.sourceKey = this.sourceKeyAttribute = this.options.sourceKey || this.source.primaryKeyAttribute;\n    this.sourceKeyField = this.source.rawAttributes[this.sourceKey].field || this.sourceKey;\n    this.sourceKeyIsPrimary = this.sourceKey === this.source.primaryKeyAttribute;\n\n    this.associationAccessor = this.as;\n    this.options.useHooks = options.useHooks;\n\n    if (this.target.rawAttributes[this.foreignKey]) {\n      this.identifierField = this.target.rawAttributes[this.foreignKey].field || this.foreignKey;\n    }\n\n    // Get singular name, trying to uppercase the first letter, unless the model forbids it\n    const singular = _.upperFirst(this.options.name.singular);\n\n    this.accessors = {\n      get: `get${singular}`,\n      set: `set${singular}`,\n      create: `create${singular}`\n    };\n  }\n\n  // the id is in the target table\n  _injectAttributes() {\n    const newAttributes = {\n      [this.foreignKey]: {\n        type: this.options.keyType || this.source.rawAttributes[this.sourceKey].type,\n        allowNull: true,\n        ...this.foreignKeyAttribute\n      }\n    };\n\n    if (this.options.constraints !== false) {\n      const target = this.target.rawAttributes[this.foreignKey] || newAttributes[this.foreignKey];\n      this.options.onDelete = this.options.onDelete || (target.allowNull ? 'SET NULL' : 'CASCADE');\n      this.options.onUpdate = this.options.onUpdate || 'CASCADE';\n    }\n\n    Helpers.addForeignKeyConstraints(newAttributes[this.foreignKey], this.source, this.target, this.options, this.sourceKeyField);\n    Utils.mergeDefaults(this.target.rawAttributes, newAttributes);\n\n    this.target.refreshAttributes();\n\n    this.identifierField = this.target.rawAttributes[this.foreignKey].field || this.foreignKey;\n\n    Helpers.checkNamingCollision(this);\n\n    return this;\n  }\n\n  mixin(obj) {\n    const methods = ['get', 'set', 'create'];\n\n    Helpers.mixinMethods(this, obj, methods);\n  }\n\n  /**\n   * Get the associated instance.\n   *\n   * @param {Model|Array<Model>} instances source instances\n   * @param {object}         [options] find options\n   * @param {string|boolean} [options.scope] Apply a scope on the related model, or remove its default scope by passing false\n   * @param {string} [options.schema] Apply a schema on the related model\n   *\n   * @see\n   * {@link Model.findOne} for a full explanation of options\n   *\n   * @returns {Promise<Model>}\n   */\n  async get(instances, options) {\n    const where = {};\n\n    let Target = this.target;\n    let instance;\n\n    options = Utils.cloneDeep(options);\n\n    if (Object.prototype.hasOwnProperty.call(options, 'scope')) {\n      if (!options.scope) {\n        Target = Target.unscoped();\n      } else {\n        Target = Target.scope(options.scope);\n      }\n    }\n\n    if (Object.prototype.hasOwnProperty.call(options, 'schema')) {\n      Target = Target.schema(options.schema, options.schemaDelimiter);\n    }\n\n    if (!Array.isArray(instances)) {\n      instance = instances;\n      instances = undefined;\n    }\n\n    if (instances) {\n      where[this.foreignKey] = {\n        [Op.in]: instances.map(_instance => _instance.get(this.sourceKey))\n      };\n    } else {\n      where[this.foreignKey] = instance.get(this.sourceKey);\n    }\n\n    if (this.scope) {\n      Object.assign(where, this.scope);\n    }\n\n    options.where = options.where ?\n      { [Op.and]: [where, options.where] } :\n      where;\n\n    if (instances) {\n      const results = await Target.findAll(options);\n      const result = {};\n      for (const _instance of instances) {\n        result[_instance.get(this.sourceKey, { raw: true })] = null;\n      }\n\n      for (const _instance of results) {\n        result[_instance.get(this.foreignKey, { raw: true })] = _instance;\n      }\n\n      return result;\n    }\n\n    return Target.findOne(options);\n  }\n\n  /**\n   * Set the associated model.\n   *\n   * @param {Model} sourceInstance the source instance\n   * @param {?Model|string|number} [associatedInstance] An persisted instance or the primary key of an instance to associate with this. Pass `null` or `undefined` to remove the association.\n   * @param {object} [options] Options passed to getAssociation and `target.save`\n   *\n   * @returns {Promise}\n   */\n  async set(sourceInstance, associatedInstance, options) {\n    options = { ...options, scope: false };\n\n    const oldInstance = await sourceInstance[this.accessors.get](options);\n    // TODO Use equals method once #5605 is resolved\n    const alreadyAssociated = oldInstance && associatedInstance && this.target.primaryKeyAttributes.every(attribute =>\n      oldInstance.get(attribute, { raw: true }) === (associatedInstance.get ? associatedInstance.get(attribute, { raw: true }) : associatedInstance)\n    );\n\n    if (oldInstance && !alreadyAssociated) {\n      oldInstance[this.foreignKey] = null;\n\n      await oldInstance.save({\n        ...options,\n        fields: [this.foreignKey],\n        allowNull: [this.foreignKey],\n        association: true\n      });\n    }\n    if (associatedInstance && !alreadyAssociated) {\n      if (!(associatedInstance instanceof this.target)) {\n        const tmpInstance = {};\n        tmpInstance[this.target.primaryKeyAttribute] = associatedInstance;\n        associatedInstance = this.target.build(tmpInstance, {\n          isNewRecord: false\n        });\n      }\n\n      Object.assign(associatedInstance, this.scope);\n      associatedInstance.set(this.foreignKey, sourceInstance.get(this.sourceKeyAttribute));\n\n      return associatedInstance.save(options);\n    }\n\n    return null;\n  }\n\n  /**\n   * Create a new instance of the associated model and associate it with this.\n   *\n   * @param {Model} sourceInstance the source instance\n   * @param {object} [values={}] values to create associated model instance with\n   * @param {object} [options] Options passed to `target.create` and setAssociation.\n   *\n   * @see\n   * {@link Model#create} for a full explanation of options\n   *\n   * @returns {Promise<Model>} The created target model\n   */\n  async create(sourceInstance, values, options) {\n    values = values || {};\n    options = options || {};\n\n    if (this.scoH‹H‹	éµ&  ÌÌÌÌÌH‹H‹	é(  ÌH‹ÄH‰XH‰hVWAVHì°   H‹´$ø   H‹ú)pØH‹é)xÈH‹ÖD)@¸H‹ÏD)H¨D)P˜D(ÓD)XˆD(ÚD)d$@D(âD)t$0è5^ÄÿHŒ$à   ò„$à   (ÓA(ÌèxK×ÿL‹´$ğ   L‹ÇM‹ÎH‰t$ H‹Íèaıÿÿò¼$à   M‹Î(ÏH‰t$ L‹ÇH‹ÍD(Èè>ıÿÿEWÀ(ğfE/È»   v‹Ãë3ÀfE/Á–À+ÃfA/ğfnÈóæÉv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ÈŠ©   …£   M‹ÎH‰t$ L‹ÇA(ÊH‹ÍE(âèÉüÿÿfA/À(Èv‹Ãë3ÀfD/Á–À+ÃfA/ğfnĞóæÒv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ĞzAu?òĞS TÈDTÈfD/ÉTğrf/ñrA(úëfA/ÉrfA/ñrA(û(ÏéÑ  òD5xt— E(ÔM‹ÎH‰t$ L‹ÇA(ÌH‹ÍèüÿÿM‹ÎH‰t$ L‹Ç(ÏH‹ÍD(ØèüÿÿM‹ÎH‰t$ L‹ÇA(ÊH‹ÍD(ÈèèûÿÿfE.Ù(ØztfD.Ëzt	fA.Ûz%u#(ÏA(ÁòA\Ì(÷òA\ÃòAYÉò^Èò\ñëtA(ËòEYÓò\ËA(ÃòA\ÁA(ñòAYôA(ÓòY×òYÈA(ÁòYóòA\ÃòYÓòEYÑò^ñA(Éò\ËòYÈ(ÃòA\ÁòA\Ûò^ÑòYÃòXòòD^ĞòAXò(ÇòAXÄòYsO f/ğrf/şsf/÷rf/Æs(ğM‹ÎH‰t$ L‹Ç(ÎH‹Íèòúÿÿ(ÈT@R fD/ñwnfE/Èv‹Ãë3ÀfE/Á–À+ÃfA/ÀfnÈóæÉv‹Ãë3ÀfD/À–À+ÃfnÀóæÀf.ÈztD(çD(×(ÆòA\Â(şTÙQ f/‰N ƒ?şÿÿ(ÎM‹ÎH‰´$ğ   L‹ÇH‹ÍLœ$°   I‹[ I‹k(A(sğA({àE(CĞE(KÀE(S°E([ E(cE(s€I‹ãA^_^éúÿÿÌÌÌH‹ÄH‰XH‰hVWAVHì°   H‹´$ø   H‹ú)pØH‹é)xÈH‹ÖD)@¸H‹ÏD)H¨D)P˜D(ÓD)XˆD(ÚD)d$@D(âD)t$0èQZÄÿHŒ$à   ò„$à   (ÓA(Ìè”G×ÿL‹´$ğ   L‹ÇM‹ÎH‰t$ H‹Íèµùÿÿò¼$à   M‹Î(ÏH‰t$ L‹ÇH‹ÍD(Èè’ùÿÿEWÀ(ğfE/È»   v‹Ãë3ÀfE/Á–À+ÃfA/ğfnÈóæÉv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ÈŠ©   …£   M‹ÎH‰t$ L‹ÇA(ÊH‹ÍE(âèùÿÿfA/À(Èv‹Ãë3ÀfD/Á–À+ÃfA/ğfnĞóæÒv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ĞzAu?òìO TÈDTÈfD/ÉTğrf/ñrA(úëfA/ÉrfA/ñrA(û(ÏéÑ  òD5”p— E(ÔM‹ÎH‰t$ L‹ÇA(ÌH‹ÍèqøÿÿM‹ÎH‰t$ L‹Ç(ÏH‹ÍD(ØèWøÿÿM‹ÎH‰t$ L‹ÇA(ÊH‹ÍD(Èè<øÿÿfE.Ù(ØztfD.Ëzt	fA.Ûz%u#(ÏA(ÁòA\Ì(÷òA\ÃòAYÉò^Èò\ñëtA(ËòEYÓò\ËA(ÃòA\ÁA(ñòAYôA(ÓòY×òYÈA(ÁòYóòA\ÃòYÓòEYÑò^ñA(Éò\ËòYÈ(ÃòA\ÁòA\Ûò^ÑòYÃòXòòD^ĞòAXò(ÇòAXÄòYK f/ğrf/şsf/÷rf/Æs(ğM‹ÎH‰t$ L‹Ç(ÎH‹ÍèF÷ÿÿ(ÈT\N fD/ñwnfE/Èv‹Ãë3ÀfE/Á–À+ÃfA/ÀfnÈóæÉv‹Ãë3ÀfD/À–À+ÃfnÀóæÀf.ÈztD(çD(×(ÆòA\Â(şTõM f/¥J ƒ?şÿÿ(ÎM‹ÎH‰´$ğ   L‹ÇH‹ÍLœ$°   I‹[ I‹k(A(sğA({àE(CĞE(KÀE(S°E([ E(cE(s€I‹ãA^_^éoöÿÿÌÌÌH‹ÄH‰XH‰hVWAVHì°   H‹´$ø   H‹ú)pØH‹é)xÈH‹ÖD)@¸H‹ÏD)H¨D)P˜D(ÓD)XˆD(ÚD)d$@D(âD)t$0èmVÄÿHŒ$à   ò„$à   (ÓA(Ìè°C×ÿL‹´$ğ   L‹ÇM‹ÎH‰t$ H‹Íè	öÿÿò¼$à   M‹Î(ÏH‰t$ L‹ÇH‹ÍD(ÈèæõÿÿEWÀ(ğfE/È»   v‹Ãë3ÀfE/Á–À+ÃfA/ğfnÈóæÉv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ÈŠ©   …£   M‹ÎH‰t$ L‹ÇA(ÊH‹ÍE(âèqõÿÿfA/À(Èv‹Ãë3ÀfD/Á–À+ÃfA/ğfnĞóæÒv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ĞzAu?òL TÈDTÈfD/ÉTğrf/ñrA(úëfA/ÉrfA/ñrA(û(ÏéÑ  òD5°l— E(ÔM‹ÎH‰t$ L‹ÇA(ÌH‹ÍèÅôÿÿM‹ÎH‰t$ L‹Ç(ÏH‹ÍD(Øè«ôÿÿM‹ÎH‰t$ L‹ÇA(ÊH‹ÍD(ÈèôÿÿfE.Ù(ØztfD.Ëzt	fA.Ûz%u#(ÏA(ÁòA\Ì(÷òA\ÃòAYÉò^Èò\ñëtA(ËòEYÓò\ËA(ÃòA\ÁA(ñòAYôA(ÓòY×òYÈA(ÁòYóòA\ÃòYÓòEYÑò^ñA(Éò\ËòYÈ(ÃòA\ÁòA\Ûò^ÑòYÃòXòòD^ĞòAXò(ÇòAXÄòY«G f/ğrf/şsf/÷rf/Æs(ğM‹ÎH‰t$ L‹Ç(ÎH‹Íèšóÿÿ(ÈTxJ fD/ñwnfE/Èv‹Ãë3ÀfE/Á–À+ÃfA/ÀfnÈóæÉv‹Ãë3ÀfD/À–À+ÃfnÀóæÀf.ÈztD(çD(×(ÆòA\Â(şTJ f/ÁF ƒ?şÿÿ(ÎM‹ÎH‰´$ğ   L‹ÇH‹ÍLœ$°   I‹[ I‹k(A(sğA({àE(CĞE(KÀE(S°E([ E(cE(s€I‹ãA^_^éÃòÿÿÌÌÌH‹ÄH‰XH‰hVWAVHì°   H‹´$ø   H‹ú)pØH‹é)xÈH‹ÖD)@¸H‹ÏD)H¨D)P˜D(ÓD)XˆD(ÚD)d$@D(âD)t$0è‰RÄÿHŒ$à   ò„$à   (ÓA(ÌèÌ?×ÿL‹´$ğ   L‹ÇM‹ÎH‰t$ H‹Íè•òÿÿò¼$à   M‹Î(ÏH‰t$ L‹ÇH‹ÍD(ÈèròÿÿEWÀ(ğfE/È»   v‹Ãë3ÀfE/Á–À+ÃfA/ğfnÈóæÉv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ÈŠ©   …£   M‹ÎH‰t$ L‹ÇA(ÊH‹ÍE(âèıñÿÿfA/À(Èv‹Ãë3ÀfD/Á–À+ÃfA/ğfnĞóæÒv‹Ãë3ÀfD/Æ–À+ÃfnÀóæÀf.ĞzAu?ò$H TÈDTÈfD/ÉTğrf/ñrA(úëfA/ÉrfA/ñrA(û(ÏéÑ  òD5Ìh— E(ÔM‹ÎH‰t$ L‹ÇA(ÌH‹ÍèQñÿÿM‹ÎH‰t$ L‹Ç(ÏH‹ÍD(Øè7ñÿÿM‹ÎH‰t$ L‹ÇA(ÊH‹ÍD(ÈèñÿÿfE.Ù(ØztfD.Ëzt	fA.Ûz%u#(ÏA(ÁòA\Ì(÷òA\ÃòAYÉò^Èò\ñëtA(ËòEYÓò\ËA(ÃòA\ÁA(ñòAYôA(ÓòY×òYÈA(ÁòYóòA\ÃòYÓòEYÑò^ñA(Éò\ËòYÈ(ÃòA\ÁòA\Ûò^ÑòYÃòXòòD^ĞòAXò(ÇòAXÄòYÇC f/ğrf/şsf/÷rf/Æs(ğM‹ÎH‰t$ L‹Ç(ÎH‹Íè&ğÿÿ(ÈT”F fD/ñwnfE/Èv‹Ãë3ÀfE/Á–À+ÃfA/ÀfnÈóæÉv‹Ãë3ÀfD/À–À+ÃfnÀóæÀf.ÈztD(çD(×(ÆòA\Â(şT-F f/İB ƒ?şÿÿ(ÎM‹ÎH‰´$ğ   L‹ÇH‹ÍLœ$°   I‹[ I‹k(A(sğA({àE(CĞE(KÀE(S°E([ E(cE(s€I‹ãA^_^éOïÿÿÌÌÌH‹ÄL‰@UVWATAUAVAWHƒì@HÇ@¸şÿÿÿH‰X H‹ÚL‹éL%y&q L‰`D‹AHöÏ“ HHèñ_ĞÿH‹E3öD‰t$ E3ÉH‹´$   L‹ÆH•(” H‹ËH‹@8ÿØBo L‹øE9u†›   L‰¤$€   E‹ÆHÉÏ“ HŒ$€   è˜_ĞÿI‹H‹¼$€   H‹×I‹ÏH‹@ÿ‘Bo H‹èL‰¤$ˆ   E‹ÆH|Ï“ HŒ$ˆ   è[_ĞÿA‹ÎHÁáIMH‹œ$ˆ   L‹ÃH‹Õè¡E  HKôèó½ÀÿHOôèé½ÀÿAÿÆE;u‚eÿÿÿHNôèÓ½ÀÿI‹ÇH‹œ$˜   HƒÄ@A_A^A]A\_^]ÃHŠ   é(ñÅÿHŠ€   éñÅÿHŠˆ   éñÅÿH‹ÄL‰@UVWATAUAVAWHƒì@HÇ@¸şÿÿÿH‰X H‹ÚL‹éH-%q H‰hD‹AH’Î“ HHè^ĞÿH‹ƒd$  E3ÉH‹´$€   L‹ÆH} H‹ËH‹@8ÿwAo L‹àƒ¤$    Aƒ} †ó   ‹´$   H‰¬$   D‹ÆHXÎ“ HŒ$   è'^ĞÿI‹$H‹¼$   H‹×I‹ÌH‹@ÿAo L‹øH‰¬$ˆ   D‹ÆH
Î“ HŒ$ˆ   èé]Ğÿ‹ÎL4IIÁæMuI‹H‹A8ƒd$  E3ÉLy%” H‹œ$ˆ   H‹ÓI‹ÏÿÅ@o H‹èL£#” H